<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMWS - 작전 가능 현황</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .table-container {
            overflow-x: auto;
            margin: 20px;
        }
        .mission-table {
            background-color: #2a2a2a;
            border-collapse: separate;
            border-spacing: 0;
        }
        .mission-table th {
            background-color: #343a40;
            color: white;
            padding: 12px 8px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
            border: 1px solid #495057;
        }
        .mission-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #495057;
            font-size: 13px;
        }
        .base-info {
            text-align: left;
            font-weight: bold;
            background-color: #343a40 !important;
        }
        .status-go {
            background-color: #28a745;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        .status-no-go {
            background-color: #dc3545;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        .status-no-data {
            background-color: #6c757d;
            color: white;
        }
        .status-cell:hover {
            opacity: 0.8;
            transform: scale(1.05);
            transition: all 0.2s;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            font-size: 14px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-box {
            width: 30px;
            height: 20px;
            border-radius: 3px;
        }
        .filter-section {
            margin: 20px;
            padding: 15px;
            background-color: #2a2a2a;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-dark border-bottom border-secondary">
    <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">
            ✈️ AMWS - 작전 가능 현황 매트릭스
        </span>
        <div>
            <a href="/amws/" class="btn btn-sm btn-outline-light me-2">대시보드</a>
            <a href="/amws/map" class="btn btn-sm btn-outline-light me-2">지도</a>
            <a href="/amws/monitor" class="btn btn-sm btn-outline-light">모니터</a>
        </div>
    </div>
</nav>

<!-- 범례 -->
<div class="legend">
    <div class="legend-item">
        <div class="legend-box" style="background-color: #28a745;"></div>
        <span>GO (작전 가능)</span>
    </div>
    <div class="legend-item">
        <div class="legend-box" style="background-color: #dc3545;"></div>
        <span>NO-GO (작전 불가)</span>
    </div>
    <div class="legend-item">
        <div class="legend-box" style="background-color: #6c757d;"></div>
        <span>NO DATA (데이터 없음)</span>
    </div>
</div>

<!-- 필터 섹션 -->
<div class="filter-section">
    <div class="row">
        <div class="col-md-6">
            <label class="form-label">기지 필터:</label>
            <input type="text" id="baseFilter" class="form-control bg-dark text-light" placeholder="기지 ID 또는 이름 검색...">
        </div>
        <div class="col-md-6">
            <label class="form-label">항공자산 필터:</label>
            <input type="text" id="aircraftFilter" class="form-control bg-dark text-light" placeholder="항공자산 검색...">
        </div>
    </div>
</div>

<!-- 테이블 -->
<div class="table-container">
    <table class="table mission-table">
        <thead>
            <tr>
                <th rowspan="2" style="min-width: 150px;">비행장</th>
                <th rowspan="2">관측시간</th>
                <th rowspan="2">날씨</th>
                <th colspan="{{ aircraft_list|length }}" style="background-color: #495057;">항공자산 작전 가능 여부</th>
            </tr>
            <tr>
                {% for aircraft in aircraft_list %}
                <th class="aircraft-header" style="min-width: 80px;">{{ aircraft }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody id="tableBody">
            {% for base_id, base_data in bases_dict.items() %}
            <tr class="base-row" data-base="{{ base_id }} {{ base_data.base_name }}">
                <td class="base-info">{{ base_id }}<br><small>{{ base_data.base_name }}</small></td>
                <td>{{ base_data.obs_time }}</td>
                <td>{{ base_data.weather }}</td>
                
                {% for aircraft in aircraft_list %}
                    {% set asset = base_data.assets.get(aircraft, {}) %}
                    {% set status = asset.get('status', 'NO DATA') %}
                    {% set reasons = asset.get('reasons', []) %}
                    {% set crosswind = asset.get('crosswind', 0) %}
                    
                    {% if status == 'GO' %}
                        <td class="status-go status-cell" title="✅ 작전 가능">GO</td>
                    {% elif status == 'NO-GO' %}
                        <td class="status-no-go status-cell" 
                            title="❌ 작전 불가: {{ reasons|join(', ') if reasons else '제한 초과' }}">
                            NO-GO<br><small style="font-size: 10px;">{{ reasons|join(', ') }}</small>
                        </td>
                    {% else %}
                        <td class="status-no-data">-</td>
                    {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    // 기지 필터
    document.getElementById('baseFilter').addEventListener('keyup', function() {
        const filterValue = this.value.toLowerCase();
        const rows = document.querySelectorAll('.base-row');
        
        rows.forEach(row => {
            const baseText = row.getAttribute('data-base').toLowerCase();
            if (baseText.includes(filterValue)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
    
    // 항공자산 필터 (컬럼 숨김/표시)
    document.getElementById('aircraftFilter').addEventListener('keyup', function() {
        const filterValue = this.value.toLowerCase();
        const headers = document.querySelectorAll('.aircraft-header');
        
        headers.forEach((header, index) => {
            const aircraftName = header.textContent.toLowerCase();
            const columnIndex = index + 3; // 첫 3개 컬럼은 기지 정보
            
            if (aircraftName.includes(filterValue)) {
                header.style.display = '';
                // 해당 컬럼의 모든 셀 표시
                document.querySelectorAll(`tbody tr td:nth-child(${columnIndex + 1})`).forEach(cell => {
                    cell.style.display = '';
                });
            } else {
                header.style.display = 'none';
                // 해당 컬럼의 모든 셀 숨김
                document.querySelectorAll(`tbody tr td:nth-child(${columnIndex + 1})`).forEach(cell => {
                    cell.style.display = 'none';
                });
            }
        });
    });
    
    // 셀 클릭 시 상세 정보 알림 (옵션)
    document.querySelectorAll('.status-cell').forEach(cell => {
        cell.addEventListener('click', function() {
            const title = this.getAttribute('title');
            if (title) {
                alert(title);
            }
        });
    });
</script>

</body>
</html>